import { Component, OnInit } from '@angular/core';
import { ModalController, NavParams } from '@ionic/angular';
import { FirestoreService } from '../../services/firestore.service';
import { message } from '../../models/message';

@Component({
  selector: 'app-chat-consulta',
  templateUrl: './chat-consulta.component.html',
  styleUrls: ['./chat-consulta.component.scss'],
})
export class ChatConsultaComponent implements OnInit {

  /*capacity: 3
  cliente: "Ik749zAYKad44WnCs9rJU14SAxl2"
  number: 6
  photo: "data:image/jpeg;base64,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"
  qr: "mesa_6"
  type: "Personas con discapacidad"*/

  table;
  msg: string;
  chat : any = [];
  d: any = new Date();
  day = this.d.getDate();
  month = this.d.getMonth();
  year = this.d.getFullYear();
  fecha: string = this.day + '/' + this.month + '/' + this.year;
  user;

  constructor(
    private navParams : NavParams, 
    private modal : ModalController,
    private chatService : FirestoreService) { 
    }

  ngOnInit() {
    this.table = this.navParams.get('data');
    console.log(this.table)
    console.log(this.table)
    this.user = JSON.parse(localStorage.getItem('userCatch')); //obtengo user

    this.chatService.getDataChat(this.table.cliente).subscribe(item => {
      this.chat = item;
      console.log("datos: ",this.chat);
    })
  }

  sendMessage() {
      const message: message = {
        content: this.msg,
        date: this.fecha,
        user: this.user.perfil
      }
      this.chatService.sendMsgToDirebase(message, 'chat', this.table.cliente);
      this.msg = "";
  }

  onClose(){
    this.modal.dismiss();
  }

}
